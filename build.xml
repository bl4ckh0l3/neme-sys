<?xml version="1.0"?>

<project name="multifield" basedir="." default="usage">

	<property name="name" value="neme-sys"/>
	
	<property name="docname" value="neme-sys_guide.pdf"/>

	<property name="src.dir" value="src/portal"/>
	<property name="dist.dir" value="deploy"/>
	<property name="docs.dir" value="${dist.dir}/documentation"/>
	<property name="snippet.dir" value="${dist.dir}/snippet"/>
	<property name="mod_install.dir" value="${dist.dir}/mod_install"/>
	<property name="db.dir" value="db/mysql"/>
	
	<property name="ns" value="${dist.dir}/neme-sys.xsl"/>
	<property name="ens" value="${dist.dir}/econeme-sys.xsl"/>
	<property name="dens" value="${dist.dir}/demoeconeme-sys.xsl"/>
	

	<tstamp>
		<format property="build.date" pattern="yyyyMMdd" />
	</tstamp>


	<target name="usage">
		<echo message=""/>
		<echo message="neme-sys build file"/>
		<echo message="--------------------------------------"/>
		<echo message=""/>
		<echo message="Available targets are:"/>
		<echo message=""/>
	
		<echo message="task 1 = neme-sys"/>
		<echo message="--> Compile main zip sources and others file and copy neme-sys documentations"/>	
		<echo message=""/>
		<echo message="task 2 = econeme-sys"/>
		<echo message="--> Compile main zip sources and others file and copy econeme-sys documentations"/>	
		<echo message=""/>
		<echo message="task 3 = up to econeme-sys"/>
		<echo message="--> build upgrate from neme-sys to econeme-sys"/>	
		<echo message=""/>
		<echo message="task 4 = all (neme-sys + econeme-sys + docs + upto econeme-sys)"/>
		<echo message="--> build neme-sys+docs, econeme-sys+docs+upto econeme-sys"/>
		<echo message=""/>
		<echo message="task 5 = demo"/>
		<echo message="--> build demo+docs"/>
		<echo message=""/>
		<echo message="task 6 = community module"/>
		<echo message="--> build community module"/>
		<echo message=""/>
		<echo message="task 7 = blog module"/>
		<echo message="--> build blog module"/>
		<echo message=""/>
		<echo message="task 8 = ads module"/>
		<echo message="--> build ads module"/>
		<echo message=""/>
		<echo message="task 9 = voucher module"/>
		<echo message="--> build voucher module"/>
		
		
		<echo message=""/>		
		<echo message="--------------------------------------"/>
		<echo message="press CTRL + C to exit"/>		
		<echo message=""/>
		<input message="choose a target (1,2,n): " addproperty="doTask"/>
		<input message="choose a version: " addproperty="buildVers"/>
		<antcall target="task${doTask}" />
	</target>
	
	
	<target name="make_dir_app" if="dirToCreateApp"> 
		<delete dir="${dist.dir}/${buildVers}"/>
		<mkdir dir="${dist.dir}/${buildVers}"/>
		<mkdir dir="${dist.dir}/${buildVers}/docs"/>
		<mkdir dir="${dist.dir}/${buildVers}/src"/>
		<mkdir dir="${dist.dir}/${buildVers}/tmp"/>
	</target>

	<target name="make_dir_demo" if="dirToCreateDemo"> 
		<delete dir="${dist.dir}/demo/${buildVers}"/>
		<mkdir dir="${dist.dir}/demo/${buildVers}"/>
		<mkdir dir="${dist.dir}/demo/${buildVers}/src"/>
	</target> 
	

	<target name="refresh_template_zip"> 
		<delete file="${src.dir}/public/utils/templates_neme-sys.zip"/>
		<delete file="${src.dir}/public/utils/templates_econeme-sys.zip"/>
		
		<zip destfile="${src.dir}/public/utils/templates_neme-sys.zip"> 
			<zipfileset dir="${src.dir}/public/templates"> 
				<include name="**/*"/>
				<!-- file esclusi e recuperati da dir templates -->
				<exclude name="**/IT/**"/>
				<exclude name="**/EN/**"/>
				<exclude name="shopping-card/**"/>
				<exclude name="products/**"/>
				<exclude name="ads-content/**"/>
				<exclude name="googlemap-product*/**"/>
				<exclude name="voucher-module*/**"/>
				<exclude name="voucher-module-friend*/**"/>
			</zipfileset>
		</zip>
		
		<zip destfile="${src.dir}/public/utils/templates_econeme-sys.zip"> 
			<zipfileset dir="${src.dir}/public/templates"> 
				<include name="**/*"/>
				<!-- file esclusi e recuperati da dir templates -->
				<exclude name="**/IT/**"/>
				<exclude name="**/EN/**"/>
			</zipfileset>
		</zip>			
	</target> 



<!--  *****************		BUILD NEME-SYS		***************** -->
	<target name="taskReplaceCms">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/nemesys_replace.properties"/>
		
		<copy file="${src.dir}/web.config" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/web.config" flags="gis" byline="false" match="(&lt;!--nsys-web-config--&gt;)(.*?)(&lt;!---nsys-web-config--&gt;)" replace="\1${nsys-web-config}\3" />	
		
		<copy file="${src.dir}/global.asa" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global.asa" flags="gis" byline="false" match="('&lt;!--nsys-globalasa1--&gt;)(.*?)('&lt;!---nsys-globalasa1--&gt;)" replace="\1${nsys-globalasa1}\3" />	
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global.asa" flags="gis" byline="false" match="('&lt;!--nsys-globalasa2--&gt;)(.*?)('&lt;!---nsys-globalasa2--&gt;)" replace="\1${nsys-globalasa2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global.asa" flags="gis" byline="false" match="('&lt;!--nsys-globalasa3--&gt;)(.*?)('&lt;!---nsys-globalasa3--&gt;)" replace="\1${nsys-globalasa3}\3" />	
		
		<copy file="${src.dir}/public/conf/nemesi_config.xml" todir="${dist.dir}/${buildVers}/tmp/public/conf"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig1--&gt;)(.*?)(&lt;!---nsys-nemesiconfig1--&gt;)" replace="\1${nsys-nemesiconfig1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig2--&gt;)(.*?)(&lt;!---nsys-nemesiconfig2--&gt;)" replace="\1${nsys-nemesiconfig2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig3--&gt;)(.*?)(&lt;!---nsys-nemesiconfig3--&gt;)" replace="\1${nsys-nemesiconfig3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig4--&gt;)(.*?)(&lt;!---nsys-nemesiconfig4--&gt;)" replace="\1${nsys-nemesiconfig4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig5--&gt;)(.*?)(&lt;!---nsys-nemesiconfig5--&gt;)" replace="\1${nsys-nemesiconfig5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig6--&gt;)(.*?)(&lt;!---nsys-nemesiconfig6--&gt;)" replace="\1${nsys-nemesiconfig6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig7--&gt;)(.*?)(&lt;!---nsys-nemesiconfig7--&gt;)" replace="\1${nsys-nemesiconfig7}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig8--&gt;)(.*?)(&lt;!---nsys-nemesiconfig8--&gt;)" replace="\1${nsys-nemesiconfig8}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig9--&gt;)(.*?)(&lt;!---nsys-nemesiconfig9--&gt;)" replace="\1${nsys-nemesiconfig9}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig10--&gt;)(.*?)(&lt;!---nsys-nemesiconfig10--&gt;)" replace="\1${nsys-nemesiconfig10}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig11--&gt;)(.*?)(&lt;!---nsys-nemesiconfig11--&gt;)" replace="\1${nsys-nemesiconfig11}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig12--&gt;)(.*?)(&lt;!---nsys-nemesiconfig12--&gt;)" replace="\1${nsys-nemesiconfig12}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig13--&gt;)(.*?)(&lt;!---nsys-nemesiconfig13--&gt;)" replace="\1${nsys-nemesiconfig13}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig14--&gt;)(.*?)(&lt;!---nsys-nemesiconfig14--&gt;)" replace="\1${nsys-nemesiconfig14}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig15--&gt;)(.*?)(&lt;!---nsys-nemesiconfig15--&gt;)" replace="\1${nsys-nemesiconfig15}\3" />
		
		<copy file="${src.dir}/public/layout/area_user/manageuser.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/manageuser.asp" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity1--&gt;)(.*?)(&lt;!---nsys-modcommunity1--&gt;)" replace="\1${nsys-modcommunity1}\3" />
		
		<copy file="${src.dir}/public/layout/area_user/publicprofile.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/publicprofile.asp" flags="gis" byline="false" match="('&lt;!--nsys-publicprofile1--&gt;)(.*?)('&lt;!---nsys-publicprofile1--&gt;)" replace="\1${nsys-publicprofile1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/publicprofile.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-publicprofile2--&gt;\*/)(.*?)(/\*&lt;!---nsys-publicprofile2--&gt;\*/)" replace="\1${nsys-publicprofile2}\3" />
		
		<copy file="${src.dir}/public/layout/area_user/userprofile.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/userprofile.asp" flags="gis" byline="false" match="('&lt;!--nsys-userprofile1--&gt;)(.*?)('&lt;!---nsys-userprofile1--&gt;)" replace="\1${nsys-userprofile1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/userprofile.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-userprofile2--&gt;\*/)(.*?)(/\*&lt;!---nsys-userprofile2--&gt;\*/)" replace="\1${nsys-userprofile2}\3" />
		
		<copy file="${src.dir}/public/layout/css/stile.css" todir="${dist.dir}/${buildVers}/tmp/public/layout/css"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-css1--&gt;\*/)(.*?)(/\*&lt;!---nsys-css1--&gt;\*/)" replace="\1${nsys-css1}\3" />
		
		<copy file="${src.dir}/public/layout/include/header.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/header.inc" flags="gis" byline="false" match="(&lt;!--nsys-head1--&gt;)(.*?)(&lt;!---nsys-head1--&gt;)" replace="\1${nsys-head1}\3" />
		
		<copy file="${src.dir}/public/layout/include/menu_vert_sx.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/menu_vert_sx.inc" flags="gis" byline="false" match="(&lt;!--nsys-inc1--&gt;)(.*?)(&lt;!---nsys-inc1--&gt;)" replace="\1${nsys-inc1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user_mask_widget.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-incecom1--&gt;)(.*?)(&lt;!---nsys-incecom1--&gt;)" replace="\1${nsys-incecom1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity2--&gt;)(.*?)(&lt;!---nsys-modcommunity2--&gt;)" replace="\1${nsys-modcommunity2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity3--&gt;)(.*?)(&lt;!---nsys-modcommunity3--&gt;)" replace="\1${nsys-modcommunity3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modblog1--&gt;)(.*?)(&lt;!---nsys-modblog1--&gt;)" replace="\1${nsys-modblog1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user_online_widget.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_online_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity4--&gt;)(.*?)(&lt;!---nsys-modcommunity4--&gt;)" replace="\1${nsys-modcommunity4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_online_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity5--&gt;)(.*?)(&lt;!---nsys-modcommunity5--&gt;)" replace="\1${nsys-modcommunity5}\3" />

		<copy file="${src.dir}/public/layout/addson/contents/news_comments_widget.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents/news_comments_widget.asp" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity6--&gt;)(.*?)(&lt;!---nsys-modcommunity6--&gt;)" replace="\1${nsys-modcommunity6}\3" />
		
		<copy file="${src.dir}/public/layout/addson/user/user_profile_widget.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_profile_widget.inc" flags="gis" byline="false" match="('&lt;!--nsys-addsuser1--&gt;)(.*?)('&lt;!---nsys-addsuser1--&gt;)" replace="\1${nsys-addsuser1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_profile_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-addsuser2--&gt;)(.*?)(&lt;!---nsys-addsuser2--&gt;)" replace="\1${nsys-addsuser2}\3" />

		<copy file="${src.dir}/public/layout/include/popup.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/popup.asp" flags="gis" byline="false" match="('&lt;!--nsys-popup1--&gt;)(.*?)('&lt;!---nsys-popup1--&gt;)" replace="\1${nsys-popup1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/popup.asp" flags="gis" byline="false" match="('&lt;!--nsys-popup2--&gt;)(.*?)('&lt;!---nsys-popup2--&gt;)" replace="\1${nsys-popup2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/popup.asp" flags="gis" byline="false" match="('&lt;!--nsys-popup3--&gt;)(.*?)('&lt;!---nsys-popup3--&gt;)" replace="\1${nsys-popup3}\3" />

		<copy file="${src.dir}/editor/index.asp" todir="${dist.dir}/${buildVers}/tmp/editor"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/index.asp" flags="gis" byline="false" match="(&lt;!--nsys-bohome1--&gt;)(.*?)(&lt;!---nsys-bohome1--&gt;)" replace="\1${nsys-bohome1}\3" />

		<copy file="${src.dir}/editor/utenti/mail_notif/mail_utente_guest.asp" todir="${dist.dir}/${buildVers}/tmp/editor/utenti/mail_notif"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/mail_notif/mail_utente_guest.asp" flags="gis" byline="false" match="('&lt;!--nsys-usrmail1--&gt;)(.*?)('&lt;!---nsys-usrmail1--&gt;)" replace="\1${nsys-usrmail1}\3" />

		<copy file="${src.dir}/editor/utenti/mail_notif/mail_utente_admin.asp" todir="${dist.dir}/${buildVers}/tmp/editor/utenti/mail_notif"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/mail_notif/mail_utente_admin.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrmail2--&gt;)(.*?)(&lt;!---nsys-usrmail2--&gt;)" replace="\1${nsys-usrmail2}\3" />

		<copy file="${src.dir}/editor/utenti/include/init2.asp" todir="${dist.dir}/${buildVers}/tmp/editor/utenti/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/include/init2.asp" flags="gis" byline="false" match="('&lt;!--nsys-usrinc1--&gt;)(.*?)('&lt;!---nsys-usrinc1--&gt;)" replace="\1${nsys-usrinc1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/include/init2.asp" flags="gis" byline="false" match="('&lt;!--nsys-usrinc2--&gt;)(.*?)('&lt;!---nsys-usrinc2--&gt;)" replace="\1${nsys-usrinc2}\3" />

		<copy file="${src.dir}/editor/utenti/listautenti.asp" todir="${dist.dir}/${buildVers}/tmp/editor/utenti"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/listautenti.asp" flags="gis" byline="false" match="('&lt;!--nsys-usrlist1--&gt;)(.*?)('&lt;!---nsys-usrlist1--&gt;)" replace="\1${nsys-usrlist1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/listautenti.asp" flags="gis" byline="false" match="(/*&lt;!--nsys-usrlist2--&gt;)(.*?)(&lt;!---nsys-usrlist2--&gt;)" replace="\1${nsys-usrlist2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/listautenti.asp" flags="gis" byline="false" match="('&lt;!--nsys-usrlist3--&gt;)(.*?)('&lt;!---nsys-usrlist3--&gt;)" replace="\1${nsys-usrlist3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/listautenti.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrlist4--&gt;)(.*?)(&lt;!---nsys-usrlist4--&gt;)" replace="\1${nsys-usrlist4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/listautenti.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrlist5--&gt;)(.*?)(&lt;!---nsys-usrlist5--&gt;)" replace="\1${nsys-usrlist5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/listautenti.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrlist6--&gt;)(.*?)(&lt;!---nsys-usrlist6--&gt;)" replace="\1${nsys-usrlist6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/listautenti.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrlist7--&gt;)(.*?)(&lt;!---nsys-usrlist7--&gt;)" replace="\1${nsys-usrlist7}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/listautenti.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrlist8--&gt;)(.*?)(&lt;!---nsys-usrlist8--&gt;)" replace="\1${nsys-usrlist8}\3" />

		<copy file="${src.dir}/editor/utenti/inserisciutente.asp" todir="${dist.dir}/${buildVers}/tmp/editor/utenti"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/inserisciutente.asp" flags="gis" byline="false" match="('&lt;!--nsys-usrins1--&gt;)(.*?)('&lt;!---nsys-usrins1--&gt;)" replace="\1${nsys-usrins1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/inserisciutente.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-usrins2--&gt;\*/)(.*?)(/\*&lt;!---nsys-usrins2--&gt;\*/)" replace="\1${nsys-usrins2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/inserisciutente.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrins3--&gt;)(.*?)(&lt;!---nsys-usrins3--&gt;)" replace="\1${nsys-usrins3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/inserisciutente.asp" flags="gis" byline="false" match="('&lt;!--nsys-usrins4--&gt;)(.*?)('&lt;!---nsys-usrins4--&gt;)" replace="\1${nsys-usrins4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/inserisciutente.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrins5--&gt;)(.*?)(&lt;!---nsys-usrins5--&gt;)" replace="\1${nsys-usrins5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/inserisciutente.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrins6--&gt;)(.*?)(&lt;!---nsys-usrins6--&gt;)" replace="\1${nsys-usrins6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/inserisciutente.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrins7--&gt;)(.*?)(&lt;!---nsys-usrins7--&gt;)" replace="\1${nsys-usrins7}\3" />

		<copy file="${src.dir}/editor/utenti/inseriscifield.asp" todir="${dist.dir}/${buildVers}/tmp/editor/utenti"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/utenti/inseriscifield.asp" flags="gis" byline="false" match="(&lt;!--nsys-usrfld1--&gt;)(.*?)(&lt;!---nsys-usrfld1--&gt;)" replace="\1${nsys-usrfld1}\3" />

		<copy file="${src.dir}/editor/templates/inseriscitemplate.asp" todir="${dist.dir}/${buildVers}/tmp/editor/templates"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/templates/inseriscitemplate.asp" flags="gis" byline="false" match="(&lt;!--nsys-tmpins1--&gt;)(.*?)(&lt;!---nsys-tmpins1--&gt;)" replace="\1${nsys-tmpins1}\3" />

		<copy file="${src.dir}/editor/templates/ajaxviewtemplate.asp" todir="${dist.dir}/${buildVers}/tmp/editor/templates"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/templates/ajaxviewtemplate.asp" flags="gis" byline="false" match="(&lt;!--nsys-tmpajx1--&gt;)(.*?)(&lt;!---nsys-tmpajx1--&gt;)" replace="\1${nsys-tmpajx1}\3" />

		<copy file="${src.dir}/editor/targets/listatarget.asp" todir="${dist.dir}/${buildVers}/tmp/editor/targets"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/targets/listatarget.asp" flags="gis" byline="false" match="('&lt;!--nsys-trglist1--&gt;)(.*?)('&lt;!---nsys-trglist1--&gt;)" replace="\1${nsys-trglist1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/targets/listatarget.asp" flags="gis" byline="false" match="('&lt;!--nsys-trglist2--&gt;)(.*?)('&lt;!---nsys-trglist2--&gt;)" replace="\1${nsys-trglist2}\3" />

		<copy file="${src.dir}/editor/targets/inseriscitarget.asp" todir="${dist.dir}/${buildVers}/tmp/editor/targets"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/targets/inseriscitarget.asp" flags="gis" byline="false" match="('&lt;!--nsys-trgins1--&gt;)(.*?)('&lt;!---nsys-trgins1--&gt;)" replace="\1${nsys-trgins1}\3" />

		<copy file="${src.dir}/editor/report/create-user-excel.asp" todir="${dist.dir}/${buildVers}/tmp/editor/report"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/report/create-user-excel.asp" flags="gis" byline="false" match="('&lt;!--nsys-rep1--&gt;)(.*?)('&lt;!---nsys-rep1--&gt;)" replace="\1${nsys-rep1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/report/create-user-excel.asp" flags="gis" byline="false" match="('&lt;!--nsys-rep2--&gt;)(.*?)('&lt;!---nsys-rep2--&gt;)" replace="\1${nsys-rep2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/report/create-user-excel.asp" flags="gis" byline="false" match="('&lt;!--nsys-rep3--&gt;)(.*?)('&lt;!---nsys-rep3--&gt;)" replace="\1${nsys-rep3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/report/create-user-excel.asp" flags="gis" byline="false" match="('&lt;!--nsys-rep4--&gt;)(.*?)('&lt;!---nsys-rep4--&gt;)" replace="\1${nsys-rep4}\3" />

		<copy file="${src.dir}/editor/report/create-user-csv.asp" todir="${dist.dir}/${buildVers}/tmp/editor/report"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/report/create-user-csv.asp" flags="gis" byline="false" match="('&lt;!--nsys-rep5--&gt;)(.*?)('&lt;!---nsys-rep5--&gt;)" replace="\1${nsys-rep5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/report/create-user-csv.asp" flags="gis" byline="false" match="('&lt;!--nsys-rep6--&gt;)(.*?)('&lt;!---nsys-rep6--&gt;)" replace="\1${nsys-rep6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/report/create-user-csv.asp" flags="gis" byline="false" match="('&lt;!--nsys-rep7--&gt;)(.*?)('&lt;!---nsys-rep7--&gt;)" replace="\1${nsys-rep7}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/report/create-user-csv.asp" flags="gis" byline="false" match="('&lt;!--nsys-rep8--&gt;)(.*?)('&lt;!---nsys-rep8--&gt;)" replace="\1${nsys-rep8}\3" />

		<copy file="${src.dir}/editor/newsletter/listanewsletter.asp" todir="${dist.dir}/${buildVers}/tmp/editor/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/newsletter/listanewsletter.asp" flags="gis" byline="false" match="('&lt;!--nsys-nwsletlist1--&gt;)(.*?)('&lt;!---nsys-nwsletlist1--&gt;)" replace="\1${nsys-nwsletlist1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/newsletter/listanewsletter.asp" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist2--&gt;)(.*?)(&lt;!---nsys-nwsletlist2--&gt;)" replace="\1${nsys-nwsletlist2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/newsletter/listanewsletter.asp" flags="gis" byline="false" match="('&lt;!--nsys-nwsletlist3--&gt;)(.*?)('&lt;!---nsys-nwsletlist3--&gt;)" replace="\1${nsys-nwsletlist3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/newsletter/listanewsletter.asp" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist4--&gt;)(.*?)(&lt;!---nsys-nwsletlist4--&gt;)" replace="\1${nsys-nwsletlist4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/newsletter/listanewsletter.asp" flags="gis" byline="false" match="(&lt;!--nsys-nwsletlist5--&gt;)(.*?)(&lt;!---nsys-nwsletlist5--&gt;)" replace="\1${nsys-nwsletlist5}\3" />

		<copy file="${src.dir}/editor/newsletter/inseriscinewsletter.asp" todir="${dist.dir}/${buildVers}/tmp/editor/newsletter"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/newsletter/inseriscinewsletter.asp" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins1--&gt;)(.*?)(&lt;!---nsys-nwsletins1--&gt;)" replace="\1${nsys-nwsletins1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/newsletter/inseriscinewsletter.asp" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins2--&gt;)(.*?)(&lt;!---nsys-nwsletins2--&gt;)" replace="\1${nsys-nwsletins2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/newsletter/inseriscinewsletter.asp" flags="gis" byline="false" match="(&lt;!--nsys-nwsletins3--&gt;)(.*?)(&lt;!---nsys-nwsletins3--&gt;)" replace="\1${nsys-nwsletins3}\3" />

		<copy file="${src.dir}/editor/include/menu.inc" todir="${dist.dir}/${buildVers}/tmp/editor/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/include/menu.inc" flags="gis" byline="false" match="(&lt;!--nsys-editinc1--&gt;)(.*?)(&lt;!---nsys-editinc1--&gt;)" replace="\1${nsys-editinc1}\3" />

		<copy file="${src.dir}/editor/include/includeshopobjectList.inc" todir="${dist.dir}/${buildVers}/tmp/editor/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/include/includeshopobjectList.inc" flags="gis" byline="false" match="('&lt;!--nsys-editinc2--&gt;)(.*?)('&lt;!---nsys-editinc2--&gt;)" replace="\1${nsys-editinc2}\3" />

		<copy file="${src.dir}/editor/include/ajaxupdate.asp" todir="${dist.dir}/${buildVers}/tmp/editor/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/include/ajaxupdate.asp" flags="gis" byline="false" match="('&lt;!--nsys-editinc3--&gt;)(.*?)('&lt;!---nsys-editinc3--&gt;)" replace="\1${nsys-editinc3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/include/ajaxupdate.asp" flags="gis" byline="false" match="('&lt;!--nsys-editinc4--&gt;)(.*?)('&lt;!---nsys-editinc4--&gt;)" replace="\1${nsys-editinc4}\3" />

		<copy file="${src.dir}/editor/include/ajaxdelete.asp" todir="${dist.dir}/${buildVers}/tmp/editor/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/include/ajaxdelete.asp" flags="gis" byline="false" match="('&lt;!--nsys-editinc5--&gt;)(.*?)('&lt;!---nsys-editinc5--&gt;)" replace="\1${nsys-editinc5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/include/ajaxdelete.asp" flags="gis" byline="false" match="('&lt;!--nsys-editinc6--&gt;)(.*?)('&lt;!---nsys-editinc6--&gt;)" replace="\1${nsys-editinc6}\3" />

		<copy file="${src.dir}/editor/countries/listacountry.asp" todir="${dist.dir}/${buildVers}/tmp/editor/countries"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/countries/listacountry.asp" flags="gis" byline="false" match="(&lt;!--nsys-cntlist1--&gt;)(.*?)(&lt;!---nsys-cntlist1--&gt;)" replace="\1${nsys-cntlist1}\3" />

		<copy file="${src.dir}/editor/categorie/listacategorie.asp" todir="${dist.dir}/${buildVers}/tmp/editor/categorie"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/categorie/listacategorie.asp" flags="gis" byline="false" match="(&lt;!--nsys-catlist1--&gt;)(.*?)(&lt;!---nsys-catlist1--&gt;)" replace="\1${nsys-catlist1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/categorie/listacategorie.asp" flags="gis" byline="false" match="(&lt;!--nsys-catlist2--&gt;)(.*?)(&lt;!---nsys-catlist2--&gt;)" replace="\1${nsys-catlist2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/categorie/listacategorie.asp" flags="gis" byline="false" match="(&lt;!--nsys-catlist3--&gt;)(.*?)(&lt;!---nsys-catlist3--&gt;)" replace="\1${nsys-catlist3}\3" />

		<copy file="${src.dir}/editor/categorie/inseriscicategoria.asp" todir="${dist.dir}/${buildVers}/tmp/editor/categorie"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/categorie/inseriscicategoria.asp" flags="gis" byline="false" match="(&lt;!--nsys-catins1--&gt;)(.*?)(&lt;!---nsys-catins1--&gt;)" replace="\1${nsys-catins1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/categorie/inseriscicategoria.asp" flags="gis" byline="false" match="(&lt;!--nsys-catins2--&gt;)(.*?)(&lt;!---nsys-catins2--&gt;)" replace="\1${nsys-catins2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/categorie/inseriscicategoria.asp" flags="gis" byline="false" match="(&lt;!--nsys-catins3--&gt;)(.*?)(&lt;!---nsys-catins3--&gt;)" replace="\1${nsys-catins3}\3" />

		<copy file="${src.dir}/common/include/Objects/UserClass.asp" todir="${dist.dir}/${buildVers}/tmp/common/include/Objects"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/common/include/Objects/UserClass.asp" flags="gis" byline="false" match="('&lt;!--nsys-objusr1--&gt;)(.*?)('&lt;!---nsys-objusr1--&gt;)" replace="\1${nsys-objusr1}\3" />
		
		<copy file="${src.dir}/common/include/includeshopobjectlist.inc" todir="${dist.dir}/${buildVers}/tmp/common/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/common/include/includeshopobjectlist.inc" flags="gis" byline="false" match="('&lt;!--nsys-inc2--&gt;)(.*?)('&lt;!---nsys-inc2--&gt;)" replace="\1${nsys-inc2}\3" />
		
		<copy file="${src.dir}/area_user/include/init2.inc" todir="${dist.dir}/${buildVers}/tmp/area_user/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/include/init2.inc" flags="gis" byline="false" match="('&lt;!--nsys-ausrinc1--&gt;)(.*?)('&lt;!---nsys-ausrinc1--&gt;)" replace="\1${nsys-ausrinc1}\3" />
		
		<copy file="${src.dir}/area_user/processusersito.asp" todir="${dist.dir}/${buildVers}/tmp/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/processusersito.asp" flags="gis" byline="false" match="('&lt;!--nsys-userproc1--&gt;)(.*?)('&lt;!---nsys-userproc1--&gt;)" replace="\1${nsys-userproc1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/processusersito.asp" flags="gis" byline="false" match="('&lt;!--nsys-userproc2--&gt;)(.*?)('&lt;!---nsys-userproc2--&gt;)" replace="\1${nsys-userproc2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/processusersito.asp" flags="gis" byline="false" match="('&lt;!--nsys-userproc3--&gt;)(.*?)('&lt;!---nsys-userproc3--&gt;)" replace="\1${nsys-userproc3}\3" />
		
		<copy file="${src.dir}/area_user/manageuser.asp" todir="${dist.dir}/${buildVers}/tmp/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/manageuser.asp" flags="gis" byline="false" match="('&lt;!--nsys-userman1--&gt;)(.*?)('&lt;!---nsys-userman1--&gt;)" replace="\1${nsys-userman1}\3" />
		
		<copy file="${src.dir}/area_user/userprofile.asp" todir="${dist.dir}/${buildVers}/tmp/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/userprofile.asp" flags="gis" byline="false" match="(&lt;!--nsys-userprofile3--&gt;)(.*?)(&lt;!---nsys-userprofile3--&gt;)" replace="\1${nsys-userprofile3}\3" />

		<copy file="${db.dir}/global_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_cms" if="zipToDeleteCms"> 
		<delete file="${dist.dir}/${buildVers}/src/${name}_${build.date}_${buildVers}.zip"/>
	</target> 	

	<target name="taskA" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteCms"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/${name}_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteCms: ${zipToDeleteCms}" />		
		<antcall target="delete_zip_cms" /> 
		<echo message=""/>
		
		<echo message=""/>
		<echo message="refresh template zip" />		
		<antcall target="refresh_template_zip" /> 
		<echo message=""/>
		
		<antcall target="taskReplaceCms" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/${name}_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}"> 
				<include name="**/*"/>		
				
				<!-- file esclusi -->
				<exclude name="global.asa"/>
				<exclude name="favicon.ico"/>		
				<exclude name="global.asa.remote"/>
				<exclude name="global.asax.old"/>
				<exclude name="sitemap.xml"/>
				<exclude name="web.config"/>
				<exclude name="smsutils.asp"/>
				<exclude name="**/test/**"/>
				<exclude name="**/app_data/**/*"/>
				<exclude name="area_user/include/*1.inc"/>
				<exclude name="area_user/include/*3.inc"/>
				<exclude name="area_user/include/*4.inc"/>				
				<exclude name="area_user/include/init2.inc"/>
				<exclude name="area_user/index.asp"/>
				<exclude name="area_user/visualizzaordine.asp"/>				
				<exclude name="area_user/listaordini.asp"/>				
				<exclude name="area_user/manageuser.asp"/>			
				<exclude name="area_user/userprofile.asp"/>			
				<exclude name="area_user/processusersito.asp"/>
				<exclude name="**/area_user/ads/**/*"/>		
				<exclude name="common/img/logo.png"/>	
				<exclude name="common/include/includeshopobjectlist.inc"/>					
				<exclude name="common/include/checkin.asp"/>
				<exclude name="common/include/checkin_fault.asp"/>
				<exclude name="common/include/DownloadManager.asp"/>
				<exclude name="common/include/popupprod.asp"/>				
				<exclude name="common/include/Objects/Bills4OrderClass.asp"/>
				<exclude name="common/include/Objects/BillsClass.asp"/>
				<exclude name="common/include/Objects/ShippingAddressClass.asp"/>
				<exclude name="common/include/Objects/BillsAddressClass.asp"/>
				<exclude name="common/include/Objects/Cardclass.asp"/>
				<exclude name="common/include/Objects/DownloadableProduct4OrderClass.asp"/>
				<exclude name="common/include/Objects/DownloadableProductClass.asp"/>
				<exclude name="common/include/Objects/File4ProductsClass.asp"/>
				<exclude name="common/include/Objects/OrderClass.asp"/>
				<exclude name="common/include/Objects/PaymentClass.asp"/>
				<exclude name="common/include/Objects/PaymentFieldClass.asp"/>
				<exclude name="common/include/Objects/PaymentModuleClass.asp"/>
				<exclude name="common/include/Objects/PaymentTransactionClass.asp"/>
				<exclude name="common/include/Objects/Products4OrderClass.asp"/>
				<exclude name="common/include/Objects/ProductsCardClass.asp"/>
				<exclude name="common/include/Objects/ProductsClass.asp"/>
				<exclude name="common/include/Objects/TaxsClass.asp"/>
				<exclude name="common/include/Objects/TaxsGroupClass.asp"/>
				<exclude name="common/include/Objects/CurrencyClass.asp"/>
				<exclude name="common/include/Objects/UserGroupClass.asp"/>
				<exclude name="common/include/Objects/MarginDiscountClass.asp"/>
				<exclude name="common/include/Objects/ProductFieldClass.asp"/>
				<exclude name="common/include/Objects/ProductFieldGroupClass.asp"/>
				<exclude name="common/include/Objects/AdsClass.asp"/>
				<exclude name="common/include/Objects/BusinessRulesClass.asp"/>
				<exclude name="common/include/Objects/VoucherClass.asp"/>
				<exclude name="common/include/Objects/UserClass.asp"/>
				<exclude name="editor/index.asp"/>
				<exclude name="editor/include/ajaxupdate.asp"/>
				<exclude name="editor/include/ajaxdelete.asp"/>
				<exclude name="editor/include/menu.inc"/>
				<exclude name="editor/include/includeshopobjectlist.inc"/>
				<exclude name="editor/countries/listacountry.asp"/>
				<exclude name="editor/categorie/inseriscicategoria.asp"/>
				<exclude name="editor/categorie/listacategorie.asp"/>
				<exclude name="editor/report/create-user-csv.asp"/>
				<exclude name="editor/report/create-user-excel.asp"/>
				<exclude name="editor/utenti/listautenti.asp"/>
				<exclude name="editor/utenti/inserisciutente.asp"/>
				<exclude name="editor/utenti/inseriscifield.asp"/>
				<exclude name="editor/utenti/include/init2.asp"/>
				<exclude name="editor/utenti/mail_notif/mail_utente_admin.asp"/>
				<exclude name="editor/utenti/mail_notif/mail_utente_guest.asp"/>
				<exclude name="editor/targets/inseriscitarget.asp"/>
				<exclude name="editor/targets/listatarget.asp"/>
				<exclude name="editor/templates/ajaxviewtemplate.asp"/>
				<exclude name="editor/templates/inseriscitemplate.asp"/>
				<exclude name="editor/newsletter/inseriscinewsletter.asp"/>
				<exclude name="editor/newsletter/listanewsletter.asp"/>
				<exclude name="editor/img/logo.png"/>				
				<exclude name="**/editor/carrelli/**"/>
				<exclude name="**/editor/ordini/**"/>
				<exclude name="**/editor/payments/**"/>
				<exclude name="**/editor/prodotti/**"/>
				<exclude name="**/editor/spese/**"/>
				<exclude name="**/editor/tax/**"/>
				<exclude name="**/editor/currency/**"/>
				<exclude name="**/editor/margini/**"/>
				<exclude name="**/editor/voucher/**"/>	
				<exclude name="**/public/demo/**"/>
				<exclude name="public/layout/include/menu_vert_sx.inc"/>
				<exclude name="public/layout/include/popup.asp"/>
				<exclude name="public/layout/area_user/manageuser.asp"/>		
				<exclude name="public/layout/area_user/userprofile.asp"/>
				<exclude name="public/layout/area_user/publicprofile.asp"/>	
				<exclude name="**/public/layout/css/stile.css"/>
				<exclude name="**/public/layout/include/header.inc"/>				
				<exclude name="public/layout/addson/user/user_profile_widget.inc"/>
				<exclude name="public/layout/addson/user/user_mask_widget.inc"/>
				<exclude name="public/layout/addson/user/user_online_widget.inc"/>
				<exclude name="public/layout/addson/contents/news_comments_widget.asp"/>		
				
				<!-- *** escludo tutti i template eccetto il base *** -->
				<exclude name="**/public/templates/**/*"/>								
								
				<exclude name="**/public/upload/wysiwyg_editor/*.*"/>
				<exclude name="**/public/upload/files/news/**/*"/>
				<exclude name="**/public/upload/files/prod/**/*"/>
				<include name="**/public/upload/files/prod/fields/*"/>
				<exclude name="**/public/upload/files/user/**/*"/>
				<exclude name="**/public/upload/files/header/**/*"/>
				<exclude name="**/public/upload/files/modules/**/*"/>
				
				<exclude name="**/public/utils/${docname}"/>
				<exclude name="**/public/utils/templates_econeme-sys.zip"/>
				
				<exclude name="**/public/conf/nemesi_config.xml"/>
				
			</zipfileset>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global.asa"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="web.config"/>	
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/area_user" includes="userprofile.asp" prefix="area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/area_user" includes="processusersito.asp" prefix="area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/area_user" includes="manageuser.asp" prefix="area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/area_user/include" includes="init2.inc" prefix="area_user/include"/>				
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/common/include" includes="includeshopobjectlist.inc" prefix="common/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/common/include/Objects" includes="UserClass.asp" prefix="common/include/Objects"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor" includes="index.asp" prefix="editor"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/utenti/mail_notif" includes="mail_utente_admin.asp" prefix="editor/utenti/mail_notif"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/utenti/mail_notif" includes="mail_utente_guest.asp" prefix="editor/utenti/mail_notif"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/utenti/include" includes="init2.asp" prefix="editor/utenti/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/utenti" includes="listautenti.asp" prefix="editor/utenti"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/utenti" includes="inserisciutente.asp" prefix="editor/utenti"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/utenti" includes="inseriscifield.asp" prefix="editor/utenti"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/include" includes="ajaxupdate.asp" prefix="editor/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/include" includes="ajaxdelete.asp" prefix="editor/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/include" includes="menu.inc" prefix="editor/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/include" includes="includeshopobjectlist.inc" prefix="editor/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/categorie" includes="inseriscicategoria.asp" prefix="editor/categorie"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/categorie" includes="listacategorie.asp" prefix="editor/categorie"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/countries" includes="listacountry.asp" prefix="editor/countries"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/report" includes="create-user-csv.asp" prefix="editor/report"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/report" includes="create-user-excel.asp" prefix="editor/report"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/targets" includes="inseriscitarget.asp" prefix="editor/targets"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/targets" includes="listatarget.asp" prefix="editor/targets"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/templates" includes="ajaxviewtemplate.asp" prefix="editor/templates"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/templates" includes="inseriscitemplate.asp" prefix="editor/templates"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/newsletter" includes="inseriscinewsletter.asp" prefix="editor/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/newsletter" includes="listanewsletter.asp" prefix="editor/newsletter"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/conf" includes="nemesi_config.xml" fullpath="public/conf/nemesi_config.xml"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/area_user" includes="manageuser.asp" prefix="public/layout/area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/area_user" includes="userprofile.asp" prefix="public/layout/area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/area_user" includes="publicprofile.asp" prefix="public/layout/area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/css" includes="stile.css" prefix="public/layout/css"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/include" includes="header.inc" prefix="public/layout/include"/>	
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/include" includes="menu_vert_sx.inc" prefix="public/layout/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/include" includes="popup.asp" prefix="public/layout/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user_profile_widget.inc" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user_mask_widget.inc" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user_online_widget.inc" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents" includes="news_comments_widget.asp" prefix="public/layout/addson/contents"/>

			<!-- includo il logo di neme-sys al posto del logo econeme-sys -->
			<zipfileset dir="${snippet.dir}/cms/editor/img" includes="logo.png" prefix="editor/img"/>
			<zipfileset dir="${snippet.dir}/cms/common/img" includes="logo.png" prefix="common/img"/>
			<zipfileset dir="${snippet.dir}/cms" includes="favicon.ico" prefix=""/>

			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global_install_query.sql" prefix="public/install"/>
			
			<zipfileset dir="${mod_install.dir}" includes="portalinstall.asp" prefix="public/install"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="nemesys_replace.properties" prefix="public/install"/>
			
			<!-- includo la documentazione dentro la directory public/utils -->
			<!--<zipfileset dir="${docs.dir}" includes="${docname}" prefix="public/utils"/>-->
			
			<!-- reintegro il template base, newsletter e search dentro la directory public/templates -->
			<zipfileset dir="${src.dir}/public/templates" includes="base/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="newsletter/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="search/**/*" prefix="public/templates"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
		
	</target>	
	
	<target name="taskB" depends="taskA" description="copy docs files into deploy docs dir">
		
		<copy todir="${dist.dir}/${buildVers}/docs" preservelastmodified="true">
			<fileset dir="${docs.dir}" includes="${docname}" />
		</copy>

	</target>	

	<target name="task1" depends="taskA,taskB" description="build all neme-sys"/>
	


<!--  *****************		BUILD ECONEME-SYS		***************** -->		
	<target name="taskReplaceEco">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/econemesys_replace.properties"/>
		
		<copy file="${src.dir}/web.config" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/web.config" flags="gis" byline="false" match="(&lt;!--nsys-web-config--&gt;)(.*?)(&lt;!---nsys-web-config--&gt;)" replace="\1${nsys-web-config}\3" />	
		
		<copy file="${src.dir}/global.asa" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global.asa" flags="gis" byline="false" match="('&lt;!--nsys-globalasa1--&gt;)(.*?)('&lt;!---nsys-globalasa1--&gt;)" replace="\1${nsys-globalasa1}\3" />	
		
		<copy file="${src.dir}/public/conf/nemesi_config.xml" todir="${dist.dir}/${buildVers}/tmp/public/conf"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig1--&gt;)(.*?)(&lt;!---nsys-nemesiconfig1--&gt;)" replace="\1${nsys-nemesiconfig1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig2--&gt;)(.*?)(&lt;!---nsys-nemesiconfig2--&gt;)" replace="\1${nsys-nemesiconfig2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig3--&gt;)(.*?)(&lt;!---nsys-nemesiconfig3--&gt;)" replace="\1${nsys-nemesiconfig3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig4--&gt;)(.*?)(&lt;!---nsys-nemesiconfig4--&gt;)" replace="\1${nsys-nemesiconfig4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig5--&gt;)(.*?)(&lt;!---nsys-nemesiconfig5--&gt;)" replace="\1${nsys-nemesiconfig5}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig6--&gt;)(.*?)(&lt;!---nsys-nemesiconfig6--&gt;)" replace="\1${nsys-nemesiconfig6}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig7--&gt;)(.*?)(&lt;!---nsys-nemesiconfig7--&gt;)" replace="\1${nsys-nemesiconfig7}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig8--&gt;)(.*?)(&lt;!---nsys-nemesiconfig8--&gt;)" replace="\1${nsys-nemesiconfig8}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig9--&gt;)(.*?)(&lt;!---nsys-nemesiconfig9--&gt;)" replace="\1${nsys-nemesiconfig9}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig10--&gt;)(.*?)(&lt;!---nsys-nemesiconfig10--&gt;)" replace="\1${nsys-nemesiconfig10}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig11--&gt;)(.*?)(&lt;!---nsys-nemesiconfig11--&gt;)" replace="\1${nsys-nemesiconfig11}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig12--&gt;)(.*?)(&lt;!---nsys-nemesiconfig12--&gt;)" replace="\1${nsys-nemesiconfig12}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig13--&gt;)(.*?)(&lt;!---nsys-nemesiconfig13--&gt;)" replace="\1${nsys-nemesiconfig13}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig14--&gt;)(.*?)(&lt;!---nsys-nemesiconfig14--&gt;)" replace="\1${nsys-nemesiconfig14}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig15--&gt;)(.*?)(&lt;!---nsys-nemesiconfig15--&gt;)" replace="\1${nsys-nemesiconfig15}\3" />
		
		<copy file="${src.dir}/public/layout/css/stile.css" todir="${dist.dir}/${buildVers}/tmp/public/layout/css"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-css1--&gt;\*/)(.*?)(/\*&lt;!---nsys-css1--&gt;\*/)" replace="\1${nsys-css1}\3" />
		
		<copy file="${src.dir}/public/layout/include/header.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/include/header.inc" flags="gis" byline="false" match="(&lt;!--nsys-head1--&gt;)(.*?)(&lt;!---nsys-head1--&gt;)" replace="\1${nsys-head1}\3" />		
		
		<copy file="${src.dir}/public/layout/area_user/manageuser.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/manageuser.asp" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity1--&gt;)(.*?)(&lt;!---nsys-modcommunity1--&gt;)" replace="\1${nsys-modcommunity1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user_mask_widget.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity2--&gt;)(.*?)(&lt;!---nsys-modcommunity2--&gt;)" replace="\1${nsys-modcommunity2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity3--&gt;)(.*?)(&lt;!---nsys-modcommunity3--&gt;)" replace="\1${nsys-modcommunity3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modblog1--&gt;)(.*?)(&lt;!---nsys-modblog1--&gt;)" replace="\1${nsys-modblog1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user_online_widget.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_online_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity4--&gt;)(.*?)(&lt;!---nsys-modcommunity4--&gt;)" replace="\1${nsys-modcommunity4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_online_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity5--&gt;)(.*?)(&lt;!---nsys-modcommunity5--&gt;)" replace="\1${nsys-modcommunity5}\3" />

		<copy file="${src.dir}/public/layout/addson/contents/news_comments_widget.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents/news_comments_widget.asp" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity6--&gt;)(.*?)(&lt;!---nsys-modcommunity6--&gt;)" replace="\1${nsys-modcommunity6}\3" />
		
		<copy file="${db.dir}/global_install_query_ec.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global_install_query_ec.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />		
		
		<copy file="${src.dir}/editor/include/menu.inc" todir="${dist.dir}/${buildVers}/tmp/editor/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/include/menu.inc" flags="gis" byline="false" match="(&lt;!--nsys-voucher1--&gt;)(.*?)(&lt;!---nsys-voucher1--&gt;)" replace="\1${nsys-voucher1}\3" />
		
		<copy file="${src.dir}/editor/margini/inserisciRule.asp" todir="${dist.dir}/${buildVers}/tmp/editor/margini"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/margini/inserisciRule.asp" flags="gis" byline="false" match="(&lt;!--nsys-voucher2--&gt;)(.*?)(&lt;!---nsys-voucher2--&gt;)" replace="\1${nsys-voucher2}\3" />
	</target>
	
	<target name="delete_zip_cms.ec" if="zipToDeleteEc"> 
		<delete file="${dist.dir}/${buildVers}/src/eco${name}_${build.date}_${buildVers}.zip"/>
	</target> 
	
	<target name="taskC" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />  
		<echo message=""/>

		<condition property="zipToDeleteEc"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/eco${name}_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteEc: ${zipToDeleteEc}" />		
		<antcall target="delete_zip_cms.ec" /> 
		<echo message=""/>
		
		<echo message=""/>
		<echo message="refresh template zip" />		
		<antcall target="refresh_template_zip" /> 
		<echo message=""/>
		
		<antcall target="taskReplaceEco" />

		<zip destfile="${dist.dir}/${buildVers}/src/eco${name}_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}"> 
				<include name="**/*"/>
				
				<!-- file esclusi -->
				<exclude name="favicon.ico"/>
				<exclude name="global.asa"/>
				<exclude name="web.config"/>
				<exclude name="sitemap.xml"/>
				<exclude name="smsutils.asp"/>
				<exclude name="global.asa.remote"/>
				<exclude name="global.asax.old"/>
				<exclude name="**/test/**"/>
				<exclude name="**/app_data/**/*"/>
				<exclude name="**/area_user/ads/**/*"/>			
				<exclude name="common/img/logo.png"/>				
				<exclude name="**/public/demo/**"/>
				<exclude name="**/public/layout/css/stile.css"/>
				<exclude name="**/public/layout/include/header.inc"/>
				<exclude name="public/layout/area_user/manageuser.asp"/>	
				<exclude name="public/layout/addson/user/user_mask_widget.inc"/>
				<exclude name="public/layout/addson/user/user_online_widget.inc"/>
				<exclude name="public/layout/addson/contents/news_comments_widget.asp"/>
				
				<!-- file esclusi per il modulo voucher -->
				<exclude name="editor/include/menu.inc"/>
				<exclude name="editor/margini/inserisciRule.asp"/>
				<exclude name="**/editor/voucher/**"/>	
				
				<!-- *** escludo tutti i template eccetto il base *** -->
				<exclude name="**/public/templates/**/*"/>
				
				<exclude name="**/public/upload/wysiwyg_editor/*.*"/>
				<exclude name="**/public/upload/files/news/**/*"/>
				<exclude name="**/public/upload/files/prod/**/*"/>
				<include name="**/public/upload/files/prod/fields/*"/>
				<exclude name="**/public/upload/files/user/**/*"/>
				<exclude name="**/public/upload/files/header/**/*"/>
				<exclude name="**/public/upload/files/modules/**/*"/>
				
				<exclude name="**/public/utils/${docname}"/>
				
				<exclude name="**/public/utils/templates_neme-sys.zip"/>
				<exclude name="**/public/utils/templates_econeme-sys.zip"/>
				
				<exclude name="**/public/conf/nemesi_config.xml"/>
				
			</zipfileset>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global.asa"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="web.config"/>
			
			<zipfileset dir="${mod_install.dir}" includes="portalinstall.asp" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="nemesys_replace.properties" prefix="public/install"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="econemesys_replace.properties" prefix="public/install"/>

			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/include" includes="menu.inc" prefix="editor/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/margini" includes="inserisciRule.asp" prefix="editor/margini"/>
			
			<!-- includo il logo di neme-sys al posto del logo econeme-sys -->
			<zipfileset dir="${snippet.dir}/ecommerce/common/img" includes="logo.png" prefix="common/img"/>
			<zipfileset dir="${snippet.dir}/ecommerce" includes="favicon.ico" prefix=""/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global_install_query_ec.sql" fullpath="public/install/global_install_query.sql"/>
			
			<!-- includo la documentazione dentro la directory public/utils -->
			<!--<zipfileset dir="${docs.dir}" includes="eco${docname}" fullpath="public/utils/${docname}"/>-->

			<!-- includo i template di esempio di econeme-sys dentro la directory public/utils -->
			<zipfileset dir="${src.dir}/public/utils" includes="templates_econeme-sys.zip" fullpath="public/utils/templates_neme-sys.zip"/>
			
			<!-- reintegro il template base, newsletter, search e shopping-card dentro la directory public/templates -->
			<zipfileset dir="${src.dir}/public/templates" includes="base/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="newsletter/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="search/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="shopping-card/**/*" prefix="public/templates"/>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/css" includes="stile.css" prefix="public/layout/css"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/include" includes="header.inc" prefix="public/layout/include"/>	
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user_mask_widget.inc" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user_online_widget.inc" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents" includes="news_comments_widget.asp" prefix="public/layout/addson/contents"/>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/area_user" includes="manageuser.asp" prefix="public/layout/area_user"/>
						
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/conf" includes="nemesi_config.xml" fullpath="public/conf/nemesi_config.xml"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>

	</target>	
	
	<target name="taskD" depends="taskC" description="copy docs files into deploy docs dir">
		
		<copy todir="${dist.dir}/${buildVers}/docs" preservelastmodified="true">
			<fileset dir="${docs.dir}" includes="eco${docname}" />
		</copy>

	</target>	
	
	<target name="task2" depends="taskC,taskD" description="build all econeme-sys"/>	
	
	

<!--  *****************		BUILD UPGRADE TO ECONEME-SYS		***************** -->			
	<target name="taskReplaceUpEco">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/econemesys_replace.properties"/>
		
		<copy file="${src.dir}/global.asa" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global.asa" flags="gis" byline="false" match="('&lt;!--nsys-globalasa1--&gt;)(.*?)('&lt;!---nsys-globalasa1--&gt;)" replace="\1${nsys-globalasa1}\3" />	
		
		<copy file="${db.dir}/global_install_query_upto_ec.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/global_install_query_upto_ec.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />

		<copy file="${src.dir}/public/layout/addson/user/user_mask_widget.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity2--&gt;)(.*?)(&lt;!---nsys-modcommunity2--&gt;)" replace="\1${nsys-modcommunity2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity3--&gt;)(.*?)(&lt;!---nsys-modcommunity3--&gt;)" replace="\1${nsys-modcommunity3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_mask_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modblog1--&gt;)(.*?)(&lt;!---nsys-modblog1--&gt;)" replace="\1${nsys-modblog1}\3" />

		<copy file="${src.dir}/public/layout/addson/user/user_online_widget.inc" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_online_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity4--&gt;)(.*?)(&lt;!---nsys-modcommunity4--&gt;)" replace="\1${nsys-modcommunity4}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/user/user_online_widget.inc" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity5--&gt;)(.*?)(&lt;!---nsys-modcommunity5--&gt;)" replace="\1${nsys-modcommunity5}\3" />

		<copy file="${src.dir}/public/layout/addson/contents/news_comments_widget.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents/news_comments_widget.asp" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity6--&gt;)(.*?)(&lt;!---nsys-modcommunity6--&gt;)" replace="\1${nsys-modcommunity6}\3" />
		
		<copy file="${src.dir}/public/layout/area_user/manageuser.asp" todir="${dist.dir}/${buildVers}/tmp/public/layout/area_user"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/public/layout/area_user/manageuser.asp" flags="gis" byline="false" match="(&lt;!--nsys-modcommunity1--&gt;)(.*?)(&lt;!---nsys-modcommunity1--&gt;)" replace="\1${nsys-modcommunity1}\3" />	
		
		<copy file="${src.dir}/editor/include/menu.inc" todir="${dist.dir}/${buildVers}/tmp/editor/include"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/include/menu.inc" flags="gis" byline="false" match="(&lt;!--nsys-voucher1--&gt;)(.*?)(&lt;!---nsys-voucher1--&gt;)" replace="\1${nsys-voucher1}\3" />
		
		<copy file="${src.dir}/editor/margini/inserisciRule.asp" todir="${dist.dir}/${buildVers}/tmp/editor/margini"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/editor/margini/inserisciRule.asp" flags="gis" byline="false" match="(&lt;!--nsys-voucher2--&gt;)(.*?)(&lt;!---nsys-voucher2--&gt;)" replace="\1${nsys-voucher2}\3" />
	</target>
	
	<target name="delete_zip_upto_ec" if="zipToDeleteUpToEc"> 
		<delete file="${dist.dir}/${buildVers}/src/upto_eco${name}_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task3" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteUpToEc"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/upto_eco${name}_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteUpToEc: ${zipToDeleteUpToEc}" />		
		<antcall target="delete_zip_upto_ec" /> 
		<echo message=""/>
		
		<echo message=""/>
		<echo message="refresh template zip" />		
		<antcall target="refresh_template_zip" /> 
		<echo message=""/>
		
		<antcall target="taskReplaceUpEco" />

		<zip destfile="${dist.dir}/${buildVers}/src/upto_eco${name}_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				
				<!-- file inclusi -->								
				<include name="area_user/index.asp"/>
				<include name="area_user/visualizzaordine.asp"/>				
				<include name="area_user/listaordini.asp"/>				
				<include name="area_user/manageuser.asp"/>		
				<include name="area_user/processusersito.asp"/>		
				<include name="area_user/userprofile.asp"/>			
				<include name="area_user/include/*1.inc"/>			
				<include name="area_user/include/init2.inc"/>
				<include name="area_user/include/*3.inc"/>
				<include name="area_user/include/*4.inc"/>
				
				<include name="common/include/checkin.asp"/>
				<include name="common/include/checkin_fault.asp"/>
				<include name="common/include/DownloadManager.asp"/>
				
				<include name="common/include/Objects/UserClass.asp"/>
				<include name="common/include/Objects/Bills4OrderClass.asp"/>
				<include name="common/include/Objects/BillsAddressClass.asp"/>
				<include name="common/include/Objects/BillsClass.asp"/>
				<include name="common/include/Objects/BusinessRulesClass.asp"/>
				<include name="common/include/Objects/Cardclass.asp"/>
				<include name="common/include/Objects/CurrencyClass.asp"/>
				<include name="common/include/Objects/DownloadableProduct4OrderClass.asp"/>
				<include name="common/include/Objects/DownloadableProductClass.asp"/>
				<include name="common/include/Objects/File4ProductsClass.asp"/>
				<include name="common/include/Objects/MarginDiscountClass.asp"/>
				<include name="common/include/Objects/OrderClass.asp"/>
				<include name="common/include/Objects/PaymentClass.asp"/>
				<include name="common/include/Objects/PaymentFieldClass.asp"/>
				<include name="common/include/Objects/PaymentModuleClass.asp"/>
				<include name="common/include/Objects/PaymentTransactionClass.asp"/>
				<include name="common/include/Objects/ProductFieldClass.asp"/>
				<include name="common/include/Objects/ProductFieldGroupClass.asp"/>
				<include name="common/include/Objects/Products4OrderClass.asp"/>
				<include name="common/include/Objects/ProductsCardClass.asp"/>
				<include name="common/include/Objects/ProductsClass.asp"/>
				<include name="common/include/Objects/ShippingAddressClass.asp"/>
				<include name="common/include/Objects/TaxsClass.asp"/>				
				<include name="common/include/Objects/TaxsGroupClass.asp"/>
				<include name="common/include/Objects/UserGroupClass.asp"/>
				<include name="common/include/Objects/VoucherClass.asp"/>

				<include name="editor/index.asp"/>
				<include name="editor/img/logo.png"/>
				<include name="editor/categorie/inseriscicategoria.asp"/>
				<include name="editor/categorie/listacategorie.asp"/>	
				<include name="editor/countries/listacountry.asp"/>	
				<include name="editor/newsletter/inseriscinewsletter.asp"/>
				<include name="editor/newsletter/listanewsletter.asp"/>
				<include name="editor/report/create-user-csv.asp"/>
				<include name="editor/report/create-user-excel.asp"/>		
				<include name="editor/utenti/inserisciUtente.asp"/>				
				<include name="editor/utenti/inseriscifield.asp"/>			
				<include name="editor/utenti/listautenti.asp"/>
				<include name="editor/utenti/include/init2.asp"/>			
				<include name="editor/utenti/mail_notif/mail_utente_admin.asp"/>
				<include name="editor/utenti/mail_notif/mail_utente_guest.asp"/>
				<include name="editor/targets/inseriscitarget.asp"/>
				<include name="editor/targets/listatarget.asp"/>
				<include name="editor/templates/ajaxviewtemplate.asp"/>
				<include name="editor/templates/inseriscitemplate.asp"/>				
				<include name="**/editor/carrelli/**"/>
				<include name="**/editor/currency/**"/>
				<include name="**/editor/margini/**"/>
				<exclude name="editor/margini/inserisciRule.asp"/>
				<include name="**/editor/ordini/**"/>
				<include name="**/editor/payments/**"/>
				<include name="**/editor/prodotti/**"/>
				<include name="**/editor/spese/**"/>
				<include name="**/editor/tax/**"/>
				
				<include name="public/layout/include/menu_vert_sx.inc"/>
				<include name="public/layout/include/popup.asp"/>
				<include name="public/layout/addson/user/user_profile_widget.inc"/>
				
				<include name="public/layout/area_user/publicprofile.asp"/>
				<include name="public/layout/area_user/userprofile.asp"/>
				
				<!-- *** escludo tutti i template eccetto il base *** -->
				<exclude name="**/public/templates/**/*"/>
				
				<exclude name="**/public/demo/**"/>
				
			</zipfileset>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global.asa"/>
			
			<zipfileset dir="${mod_install.dir}" includes="portalinstall.asp" prefix="public/install"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="econemesys_replace.properties" prefix="public/install"/>

			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/include" includes="menu.inc" prefix="editor/include"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/editor/margini" includes="inserisciRule.asp" prefix="editor/margini"/>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/area_user" includes="manageuser.asp" prefix="public/layout/area_user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user_mask_widget.inc" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/user" includes="user_online_widget.inc" prefix="public/layout/addson/user"/>
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/public/layout/addson/contents" includes="news_comments_widget.asp" prefix="public/layout/addson/contents"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="global_install_query_upto_ec.sql" fullpath="public/install/global_install_query.sql"/>
			
			<!-- includo la documentazione dentro la directory public/utils -->
			<!--<zipfileset dir="${docs.dir}" includes="eco${docname}" fullpath="public/utils/${docname}"/>-->

			<!-- includo i template di esempio di econeme-sys dentro la directory public/utils -->
			<zipfileset dir="${src.dir}/public/utils" includes="templates_econeme-sys.zip" fullpath="public/utils/templates_neme-sys.zip"/>
			
			<!-- reintegro il template base e shopping-card dentro la directory public/templates -->
			<zipfileset dir="${src.dir}/public/templates" includes="base/**/*" prefix="public/templates"/>
			<zipfileset dir="${src.dir}/public/templates" includes="shopping-card/**/*" prefix="public/templates"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>

	</target>	
	


<!--  *****************		BUILD ALL		***************** -->	
	<target name="task4" depends="task1,task2,task3" description="build all"/>
	


<!--  *****************		BUILD DEMO	***************** -->		
	<target name="taskReplaceDemo">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/demo_replace.properties"/>
		
		<copy file="${src.dir}/installed.asp" todir="${dist.dir}/demo/${buildVers}/src"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/installed.asp" flags="gis" byline="false" match="(&lt;!--nsys-demoinst1--&gt;)(.*?)(&lt;!---nsys-demoinst1--&gt;)" replace="\1${nsys-demoinst1}\3" />	
		
		<copy file="${src.dir}/public/conf/nemesi_config.xml" todir="${dist.dir}/demo/${buildVers}/src/public/conf"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig1--&gt;)(.*?)(&lt;!---nsys-nemesiconfig1--&gt;)" replace="\1${nsys-nemesiconfig1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig2--&gt;)(.*?)(&lt;!---nsys-nemesiconfig2--&gt;)" replace="\1${nsys-nemesiconfig2}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig3--&gt;)(.*?)(&lt;!---nsys-nemesiconfig3--&gt;)" replace="\1${nsys-nemesiconfig3}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig4--&gt;)(.*?)(&lt;!---nsys-nemesiconfig4--&gt;)" replace="\1${nsys-nemesiconfig4}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig5--&gt;)(.*?)(&lt;!---nsys-nemesiconfig5--&gt;)" replace="\1${nsys-nemesiconfig5}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig6--&gt;)(.*?)(&lt;!---nsys-nemesiconfig6--&gt;)" replace="\1${nsys-nemesiconfig6}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig7--&gt;)(.*?)(&lt;!---nsys-nemesiconfig7--&gt;)" replace="\1${nsys-nemesiconfig7}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig8--&gt;)(.*?)(&lt;!---nsys-nemesiconfig8--&gt;)" replace="\1${nsys-nemesiconfig8}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig9--&gt;)(.*?)(&lt;!---nsys-nemesiconfig9--&gt;)" replace="\1${nsys-nemesiconfig9}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig10--&gt;)(.*?)(&lt;!---nsys-nemesiconfig10--&gt;)" replace="\1${nsys-nemesiconfig10}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig11--&gt;)(.*?)(&lt;!---nsys-nemesiconfig11--&gt;)" replace="\1${nsys-nemesiconfig11}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig12--&gt;)(.*?)(&lt;!---nsys-nemesiconfig12--&gt;)" replace="\1${nsys-nemesiconfig12}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig13--&gt;)(.*?)(&lt;!---nsys-nemesiconfig13--&gt;)" replace="\1${nsys-nemesiconfig13}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig14--&gt;)(.*?)(&lt;!---nsys-nemesiconfig14--&gt;)" replace="\1${nsys-nemesiconfig14}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;!--nsys-nemesiconfig15--&gt;)(.*?)(&lt;!---nsys-nemesiconfig15--&gt;)" replace="\1${nsys-nemesiconfig15}\3" />

		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;/)(.*?)(&gt;)" replace="\1demo_\2\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(attr_)(.*?)(&gt;)" replace="\1demo_\2\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/conf/nemesi_config.xml" flags="gis" byline="false" match="(&lt;)(([^/|!]).*?)(&gt;)" replace="\1demo_\2\4" />
		
		<copy file="${src.dir}/public/layout/css/stile.css" todir="${dist.dir}/demo/${buildVers}/src/public/layout/css"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-css1--&gt;\*/)(.*?)(/\*&lt;!---nsys-css1--&gt;\*/)" replace="\1${nsys-css1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/layout/css/stile.css" flags="gis" byline="false" match="(/\*&lt;!--nsys-democss1--&gt;\*/)(.*?)(/\*&lt;!---nsys-democss1--&gt;\*/)" replace="\1${nsys-democss1}\3" />
		
		<copy file="${src.dir}/public/layout/include/header.inc" todir="${dist.dir}/demo/${buildVers}/src/public/layout/include"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/layout/include/header.inc" flags="gis" byline="false" match="(&lt;!--nsys-head1--&gt;)(.*?)(&lt;!---nsys-head1--&gt;)" replace="\1${nsys-head1}\3" />
		
		<copy file="${src.dir}/common/include/logoff.asp" todir="${dist.dir}/demo/${buildVers}/src/common/include"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/common/include/logoff.asp" flags="gis" byline="false" match="('&lt;!--nsys-demologoff1--&gt;)(.*?)('&lt;!---nsys-demologoff1--&gt;)" replace="\1${nsys-demologoff1}\3" />
		
		<copy file="${src.dir}/common/include/verificautente.asp" todir="${dist.dir}/demo/${buildVers}/src/common/include"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/common/include/verificautente.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoverify1--&gt;)(.*?)('&lt;!---nsys-demoverify1--&gt;)" replace="\1${nsys-demoverify1}\3" />
		
		<copy file="${src.dir}/editor/configuration/portalconfig.asp" todir="${dist.dir}/demo/${buildVers}/src/editor/configuration"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/configuration/portalconfig.asp" flags="gis" byline="false" match="(&lt;!--nsys-democonf1--&gt;)(.*?)(&lt;!---nsys-democonf1--&gt;)" replace="\1${nsys-democonf1}\3" />
		
		<copy file="${src.dir}/editor/contenuti/processnews2.asp" todir="${dist.dir}/demo/${buildVers}/src/editor/contenuti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/contenuti/processnews2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc1--&gt;)(.*?)('&lt;!---nsys-demonwsproc1--&gt;)" replace="\1${nsys-demonwsproc1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/contenuti/processnews2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc2--&gt;)(.*?)('&lt;!---nsys-demonwsproc2--&gt;)" replace="\1${nsys-demonwsproc2}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/contenuti/processnews2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc3--&gt;)(.*?)('&lt;!---nsys-demonwsproc3--&gt;)" replace="\1${nsys-demonwsproc3}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/contenuti/processnews2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc4--&gt;)(.*?)('&lt;!---nsys-demonwsproc4--&gt;)" replace="\1${nsys-demonwsproc4}\3" />
		
		<copy file="${src.dir}/editor/contenuti/processnews.asp" todir="${dist.dir}/demo/${buildVers}/src/editor/contenuti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/contenuti/processnews.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc5--&gt;)(.*?)('&lt;!---nsys-demonwsproc5--&gt;)" replace="\1${nsys-demonwsproc5}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/contenuti/processnews.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc6--&gt;)(.*?)('&lt;!---nsys-demonwsproc6--&gt;)" replace="\1${nsys-demonwsproc6}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/contenuti/processnews.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc7--&gt;)(.*?)('&lt;!---nsys-demonwsproc7--&gt;)" replace="\1${nsys-demonwsproc7}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/contenuti/processnews.asp" flags="gis" byline="false" match="('&lt;!--nsys-demonwsproc8--&gt;)(.*?)('&lt;!---nsys-demonwsproc8--&gt;)" replace="\1${nsys-demonwsproc8}\3" />
		
		<copy file="${src.dir}/editor/prodotti/processprodotto.asp" todir="${dist.dir}/demo/${buildVers}/src/editor/prodotti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc1--&gt;)(.*?)('&lt;!---nsys-demoprdproc1--&gt;)" replace="\1${nsys-demoprdproc1}\3" />	
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc2--&gt;)(.*?)('&lt;!---nsys-demoprdproc2--&gt;)" replace="\1${nsys-demoprdproc2}\3" />	
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc3--&gt;)(.*?)('&lt;!---nsys-demoprdproc3--&gt;)" replace="\1${nsys-demoprdproc3}\3" />	
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc4--&gt;)(.*?)('&lt;!---nsys-demoprdproc4--&gt;)" replace="\1${nsys-demoprdproc4}\3" />	
		
		<copy file="${src.dir}/editor/prodotti/processprodotto2.asp" todir="${dist.dir}/demo/${buildVers}/src/editor/prodotti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc5--&gt;)(.*?)('&lt;!---nsys-demoprdproc5--&gt;)" replace="\1${nsys-demoprdproc5}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc6--&gt;)(.*?)('&lt;!---nsys-demoprdproc6--&gt;)" replace="\1${nsys-demoprdproc6}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc7--&gt;)(.*?)('&lt;!---nsys-demoprdproc7--&gt;)" replace="\1${nsys-demoprdproc7}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc8--&gt;)(.*?)('&lt;!---nsys-demoprdproc8--&gt;)" replace="\1${nsys-demoprdproc8}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc9--&gt;)(.*?)('&lt;!---nsys-demoprdproc9--&gt;)" replace="\1${nsys-demoprdproc9}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc10--&gt;)(.*?)('&lt;!---nsys-demoprdproc10--&gt;)" replace="\1${nsys-demoprdproc10}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc11--&gt;)(.*?)('&lt;!---nsys-demoprdproc11--&gt;)" replace="\1${nsys-demoprdproc11}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc12--&gt;)(.*?)('&lt;!---nsys-demoprdproc12--&gt;)" replace="\1${nsys-demoprdproc12}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/prodotti/processprodotto2.asp" flags="gis" byline="false" match="('&lt;!--nsys-demoprdproc13--&gt;)(.*?)('&lt;!---nsys-demoprdproc13--&gt;)" replace="\1${nsys-demoprdproc13}\3" />
		
		<copy file="${src.dir}/editor/utenti/listautenti.asp" todir="${dist.dir}/demo/${buildVers}/src/editor/utenti"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/utenti/listautenti.asp" flags="gis" byline="false" match="(&lt;!--nsys-demoeditusr1--&gt;)(.*?)(&lt;!---nsys-demoeditusr1--&gt;)" replace="\1${nsys-demoeditusr1}\3" />
				
		<copy file="${src.dir}/editor/templates/listatemplates.asp" todir="${dist.dir}/demo/${buildVers}/src/editor/templates"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/templates/listatemplates.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demoedittmp1--&gt;\*/)(.*?)(/\*&lt;!---nsys-demoedittmp1--&gt;\*/)" replace="\1${nsys-demoedittmp1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/templates/listatemplates.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demoedittmp2--&gt;\*/)(.*?)(/\*&lt;!---nsys-demoedittmp2--&gt;\*/)" replace="\1${nsys-demoedittmp2}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/templates/listatemplates.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demoedittmp3--&gt;\*/)(.*?)(/\*&lt;!---nsys-demoedittmp3--&gt;\*/)" replace="\1${nsys-demoedittmp3}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/templates/listatemplates.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demoedittmp4--&gt;\*/)(.*?)(/\*&lt;!---nsys-demoedittmp4--&gt;\*/)" replace="\1${nsys-demoedittmp4}\3" />
				
		<copy file="${src.dir}/editor/language/inseriscilingua.asp" todir="${dist.dir}/demo/${buildVers}/src/editor/language"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/language/inseriscilingua.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demolangtmp1--&gt;\*/)(.*?)(/\*&lt;!---nsys-demolangtmp1--&gt;\*/)" replace="\1${nsys-demolangtmp1}\3" />
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/editor/language/inseriscilingua.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-demolangtmp2--&gt;\*/)(.*?)(/\*&lt;!---nsys-demolangtmp2--&gt;\*/)" replace="\1${nsys-demolangtmp2}\3" />
		
		<!-- includo il file global_install_query.sql di creazione/inserimento database -->
		<copy file="${db.dir}/global_install_query_demo.sql" todir="${dist.dir}/demo/${buildVers}/src/public/install"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/install/global_install_query_demo.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
		<!-- includo il file global_reload_query.sql di aggiornamento database -->
		<copy file="${db.dir}/global_reload_query_demo.sql" todir="${dist.dir}/demo/${buildVers}/src/public/install"/>
		<replaceregexp file="${dist.dir}/demo/${buildVers}/src/public/install/global_reload_query_demo.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_demo" if="zipToDeleteDemo"> 
		<delete file="${dist.dir}/demo/${buildVers}/eco${name}.demo_${build.date}_${buildVers}.zip"/>
	</target>
	
	<target name="task5" description="copy main source files into demo dir, generate zip files">

		<condition property="dirToCreateDemo"> 
			<and>
				<not>		
					<available file="${dist.dir}/demo/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateDemo: ${dirToCreateDemo}" />		
		<antcall target="make_dir_demo" /> 
		<echo message=""/>

		<condition property="zipToDeleteDemo"> 
			<and>		
				<available file="${dist.dir}/demo/${buildVers}/eco${name}.demo_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteDemo: ${zipToDeleteDemo}" />		
		<antcall target="delete_zip_demo" /> 
		<echo message=""/>
		
		<echo message=""/>
		<echo message="refresh template zip" />		
		<antcall target="refresh_template_zip" /> 
		<echo message=""/>

		<antcall target="taskReplaceDemo" />
		
		<copy todir="${dist.dir}/demo/${buildVers}/src">
			<fileset dir="${src.dir}"> 
				<include name="**/*"/>
				
				<exclude name="sitemap.xml"/>
				<exclude name="installed.asp"/>
				<exclude name="global.asa"/>
				<exclude name="global.asa.remote"/>
				<exclude name="global.asax.old"/>
				<exclude name="web.config"/>
				<exclude name="smsutils.asp"/>
				<exclude name="**/public/demo/**"/>
				<exclude name="**/test/**"/>
				<exclude name="**/app_data/**/*"/>
				<exclude name="favicon.ico"/>

				<exclude name="/common/include/logoff.asp"/>				
				<exclude name="/common/include/verificautente.asp"/>
				
				<exclude name="**/public/layout/css/stile.css"/>
				<exclude name="**/public/layout/include/header.inc"/>
				
				<exclude name="**/public/templates/**/IT/**"/>
				<exclude name="**/public/templates/**/EN/**"/>		
				
				<exclude name="**/editor/configuration/portalconfig.asp"/>
				<exclude name="**/editor/contenuti/processnews.asp"/>
				<exclude name="**/editor/contenuti/processnews2.asp"/>
				<exclude name="**/editor/prodotti/processprodotto.asp"/>
				<exclude name="**/editor/prodotti/processprodotto2.asp"/>
				<exclude name="**/editor/utenti/listautenti.asp"/>
				<exclude name="**/editor/templates/listatemplates.asp"/>
				
				<exclude name="**/public/upload/wysiwyg_editor/*.*"/>
				<exclude name="**/public/upload/files/news/**/*"/>
				<exclude name="**/public/upload/files/prod/**/*"/>
				<include name="**/public/upload/files/prod/fields/*"/>
				<exclude name="**/public/upload/files/user/**/*"/>
				<exclude name="**/public/upload/files/header/**/*"/>
				<exclude name="**/public/upload/files/modules/**/*"/>
				
				<exclude name="**/public/utils/${docname}"/>
				
				<exclude name="**/public/conf/nemesi_config.xml"/>		

				<exclude name="**/public/utils/templates_neme-sys.zip"/>
			</fileset>
		</copy>

		<!-- sostituisco  tutte le occorrenze di 
				#include virtual="** 
				con 
				#include virtual="/public/demo 
				e di
				Application("
				con
				Application("demo_
				-->
		<replace dir="${dist.dir}/demo/${buildVers}/src" 
						token="#include virtual=&quot;" 
						value="#include virtual=&quot;/public/demo">
						<include name="**/*"/>
						<exclude name="**/*.sql"/>	
		</replace>
		<replace dir="${dist.dir}/demo/${buildVers}/src" 
						token="Application(&quot;" 
						value="Application(&quot;demo_">
						<include name="**/*"/>
						<exclude name="**/*.sql"/>
		</replace>


		<!--<xslt basedir="${dist.dir}/demo/${buildVers}/src" destdir="${dist.dir}/demo/${buildVers}/src" style="${dens}">
			<include name="**/*"/>
		</xslt> -->

		<zip destfile="${dist.dir}/demo/${buildVers}/eco${name}.demo_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${dist.dir}/demo/${buildVers}/src"> 
				<include name="**/*"/>
				<exclude name="**/public/utils/templates_econeme-sys.zip"/>				
			</zipfileset>
			
			<zipfileset dir="${mod_install.dir}" includes="demoinstall.asp" fullpath="public/install/demoinstall.asp"/>
			<zipfileset dir="${mod_install.dir}" includes="demoreload.asp" fullpath="public/install/demoreload.asp"/>
			
			<zipfileset dir="${docs.dir}" includes="eco${docname}" fullpath="public/utils/eco${docname}"/>

			<!-- includo i template di esempio di econeme-sys dentro la directory public/utils -->
			<zipfileset dir="${dist.dir}/demo/${buildVers}/src/public/utils" includes="templates_econeme-sys.zip" fullpath="public/utils/templates_neme-sys.zip"/>
		</zip>

		<!-- aggiorno nuovamente la directory ${src.dir}/public/demo con tutti i nuovi file modificati -->		
		<!--<unzip src="${dist.dir}/demo/${buildVers}/eco${name}.demo_${build.date}_${buildVers}.zip" dest="${src.dir}/public/demo" overwrite="true"/>-->
			
		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/demo/${buildVers}/src" includes="**/*"/>
		</delete>

	</target>
	
	
	<!--  *****************		BUILD MODULE COMMUNITY		***************** -->
	<target name="taskReplaceModCommunity">		
		<copy file="${mod_install.dir}/sql-resource/mod-community_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/mod-community_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_mod_community" if="zipToDeleteModCommunity"> 
		<delete file="${dist.dir}/${buildVers}/src/mod-community_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task6" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteModCommunity"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/mod-community_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteModCommunity: ${zipToDeleteModCommunity}" />		
		<antcall target="delete_zip_mod_community" /> 
		<echo message=""/>

		<antcall target="taskReplaceModCommunity" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/mod-community_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				
				<!-- file inclusi -->								
				<include name="area_user/manageuser.asp"/>
				<include name="public/layout/addson/user/user_mask_widget.inc"/>
				<include name="public/layout/addson/user/user_online_widget.inc"/>
				<include name="public/layout/addson/user/user_profile_widget.inc"/>
				<include name="public/layout/addson/contents/news_comments_widget.asp"/>				
			</zipfileset>
			
			<zipfileset dir="${mod_install.dir}" includes="mod-communityinstall.asp" fullpath="public/install/moduleinstall.asp"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="mod-community_replace.properties" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/file-resource" includes="installed.asp"/>
			<zipfileset dir="${mod_install.dir}/file-resource" includes="ReadMe.txt"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="mod-community_install_query.sql" fullpath="public/install/module_install_query.sql"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
	</target>	
	
	
	<!--  *****************		BUILD MODULE BLOG		***************** -->
	<target name="taskReplaceModBlog">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/mod-blog_replace.properties"/>
		
		<copy file="${src.dir}/area_user/ads/listanews.asp" todir="${dist.dir}/${buildVers}/tmp/area_user/ads"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-usr-lnews1--&gt;\*/)(.*?)(/\*&lt;!---nsys-usr-lnews1--&gt;\*/)" replace="\1${nsys-usr-lnews1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews2--&gt;)(.*?)(&lt;!---nsys-usr-lnews2--&gt;)" replace="\1${nsys-usr-lnews2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews3--&gt;)(.*?)(&lt;!---nsys-usr-lnews3--&gt;)" replace="\1${nsys-usr-lnews3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews4--&gt;)(.*?)(&lt;!---nsys-usr-lnews4--&gt;)" replace="\1${nsys-usr-lnews4}\3" />	
		
		<copy file="${mod_install.dir}/sql-resource/mod-blog_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/mod-blog_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_mod_blog" if="zipToDeleteModBlog"> 
		<delete file="${dist.dir}/${buildVers}/src/mod-blog_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task7" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteModBlog"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/mod-blog_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteModBlog: ${zipToDeleteModBlog}" />		
		<antcall target="delete_zip_mod_blog" /> 
		<echo message=""/>

		<antcall target="taskReplaceModBlog" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/mod-blog_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				
				<!-- file inclusi -->
				<include name="**/area_user/ads/**/*"/>	
				<exclude name="**/area_user/ads/listanews.asp"/>
				<exclude name="**/area_user/ads/deleteads.asp"/>	
				<exclude name="**/area_user/ads/inserisciads.asp"/>	
				<exclude name="**/area_user/ads/processads.asp"/>	
				<exclude name="**/area_user/ads/include/init4.inc"/>		
			</zipfileset>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/area_user/ads" includes="listanews.asp" prefix="area_user/ads"/>	
			
			<zipfileset dir="${mod_install.dir}" includes="mod-bloginstall.asp" fullpath="public/install/moduleinstall.asp"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="mod-blog_replace.properties" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/file-resource" includes="installed.asp"/>
			<zipfileset dir="${mod_install.dir}/file-resource" includes="ReadMe.txt"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="mod-blog_install_query.sql" fullpath="public/install/module_install_query.sql"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
	</target>	
	
	
	<!--  *****************		BUILD MODULE ADS		***************** -->
	<target name="taskReplaceModAds">
		<loadproperties srcFile="${mod_install.dir}/replace-resource/mod-ads_replace.properties"/>
		
		<copy file="${src.dir}/area_user/ads/listanews.asp" todir="${dist.dir}/${buildVers}/tmp/area_user/ads"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(/\*&lt;!--nsys-usr-lnews1--&gt;\*/)(.*?)(/\*&lt;!---nsys-usr-lnews1--&gt;\*/)" replace="\1${nsys-usr-lnews1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews2--&gt;)(.*?)(&lt;!---nsys-usr-lnews2--&gt;)" replace="\1${nsys-usr-lnews2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews3--&gt;)(.*?)(&lt;!---nsys-usr-lnews3--&gt;)" replace="\1${nsys-usr-lnews3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews4--&gt;)(.*?)(&lt;!---nsys-usr-lnews4--&gt;)" replace="\1${nsys-usr-lnews4}\3" />	
		
		<copy file="${mod_install.dir}/sql-resource/mod-ads_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/mod-ads_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_mod_ads" if="zipToDeleteModAds"> 
		<delete file="${dist.dir}/${buildVers}/src/mod-ads_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task8" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteModAds"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/mod-ads_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteModAds: ${zipToDeleteModAds}" />		
		<antcall target="delete_zip_mod_ads" /> 
		<echo message=""/>

		<antcall target="taskReplaceModAds" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/mod-ads_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				
				<!-- file inclusi -->
				<include name="**/area_user/ads/**/*"/>	
				<exclude name="**/area_user/ads/listanews.asp"/>		
			</zipfileset>
			
			<zipfileset dir="${dist.dir}/${buildVers}/tmp/area_user/ads" includes="listanews.asp" prefix="area_user/ads"/>	
			
			<zipfileset dir="${mod_install.dir}" includes="mod-adsinstall.asp" fullpath="public/install/moduleinstall.asp"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="mod-ads_replace.properties" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/file-resource" includes="installed.asp"/>
			<zipfileset dir="${mod_install.dir}/file-resource" includes="ReadMe.txt"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="mod-ads_install_query.sql" fullpath="public/install/module_install_query.sql"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
	</target>
	
	
	<!--  *****************		BUILD MODULE VOUCHER		***************** -->
	<target name="taskReplaceModVoucher">
		<copy file="${mod_install.dir}/sql-resource/mod-voucher_install_query.sql" todir="${dist.dir}/${buildVers}/tmp"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/mod-voucher_install_query.sql" flags="gis" byline="false" match="buildVersSql" replace="${buildVers}" />
	</target>
	
	<target name="delete_zip_mod_voucher" if="zipToDeleteModVoucher"> 
		<delete file="${dist.dir}/${buildVers}/src/mod-voucher_${build.date}_${buildVers}.zip"/>
	</target> 
		
	<target name="task9" description="copy main source files into deploy dir, generate zip files">

		<condition property="dirToCreateApp"> 
			<and>
				<not>		
					<available file="${dist.dir}/${buildVers}" type="dir"> 
					</available>
				</not>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="dirToCreateApp: ${dirToCreateApp}" />		
		<antcall target="make_dir_app" />
		<echo message=""/>

		<condition property="zipToDeleteModVoucher"> 
			<and>		
				<available file="${dist.dir}/${buildVers}/src/mod-voucher_${build.date}_${buildVers}.zip"> 
				</available>
			</and> 
		</condition> 
		
		<echo message=""/>
		<echo message="zipToDeleteModVoucher: ${zipToDeleteModVoucher}" />		
		<antcall target="delete_zip_mod_voucher" /> 
		<echo message=""/>

		<antcall target="taskReplaceModVoucher" />
		
		<zip destfile="${dist.dir}/${buildVers}/src/mod-voucher_${build.date}_${buildVers}.zip"> 
			<zipfileset dir="${src.dir}">
				
				<!-- file inclusi -->
				<include name="editor/include/menu.inc"/>
				<include name="editor/margini/inserisciRule.asp"/>
				<include name="**/editor/voucher/**"/>		
			</zipfileset>
						
			<zipfileset dir="${mod_install.dir}" includes="mod-voucherinstall.asp" fullpath="public/install/moduleinstall.asp"/>
			<zipfileset dir="${mod_install.dir}/replace-resource" includes="mod-voucher_replace.properties" prefix="public/install"/>			
			<zipfileset dir="${mod_install.dir}/file-resource" includes="installed.asp"/>
			<zipfileset dir="${mod_install.dir}/file-resource" includes="ReadMe.txt"/>
			
			<!-- includo il file global_install_query.sql di creazione/inserimento database -->
			<zipfileset dir="${dist.dir}/${buildVers}/tmp" includes="mod-voucher_install_query.sql" fullpath="public/install/module_install_query.sql"/>
		</zip>

		<delete includeemptydirs="true">
			<fileset dir="${dist.dir}/${buildVers}/tmp" includes="**/*"/>
		</delete>
	</target>


	<!--  *****************		TASK DI PROVA PER SPERIMENTARE FUNZIONALITA' ANT	***************** -->
	<target name="tasktestreplace">
		<loadproperties srcFile="${mod_install.dir}/test.properties"/>

		<copy file="${src.dir}/area_user/ads/listanews.asp" todir="${dist.dir}/${buildVers}/tmp/area_user/ads"/>
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(/\*nsys-usr-lnews1\*/)(.*?)(/\*-nsys-usr-lnews1\*/)" replace="\1${nsys-usr-lnews1}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews2--&gt;)(.*?)(&lt;!---nsys-usr-lnews2--&gt;)" replace="\1${nsys-usr-lnews2}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews3--&gt;)(.*?)(&lt;!---nsys-usr-lnews3--&gt;)" replace="\1${nsys-usr-lnews3}\3" />
		<replaceregexp file="${dist.dir}/${buildVers}/tmp/area_user/ads/listanews.asp" flags="gis" byline="false" match="(&lt;!--nsys-usr-lnews4--&gt;)(.*?)(&lt;!---nsys-usr-lnews4--&gt;)" replace="\1${nsys-usr-lnews4}\3" />		
		
		<!--<replaceregexp flags="gis" byline="false" match="(&lt;div id=&quot;top-bar-lenguage&quot;&gt;)(.*?)(&lt;/div&gt;)">
		<substitution expression="\1${key.n}\3"/>
		<fileset dir="${mod_install.dir}">
			<include name="moduleinstall.asp"/>
		</fileset>
		</replaceregexp>-->

		<!--<replace dir="${dist.dir}/demo/${buildVers}/src"> 
			<include name="**/*"/>		    
			<replacefilter>
				<replacetoken><![CDATA[<cfinclude template="/MachII/customtags/view/helper/viewTagBuilder.cfm" />]]></replacetoken>  
				<replacevalue><![CDATA[two line token]]></replacevalue>
			</replacefilter>
		</replace>
		
		<replace file="${temp.dir.web-inf}/applicationContext.xml" token="@db_url@" value="${db_url}" />
		-->
	</target>
</project>